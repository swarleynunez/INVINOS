openapi: '3.0.2'
info:
  title: API for INVINOS blockchain broker
  description: Esta es la API para el brocker de INVINOS con el que hay que interactuar para realizar transacciones en la blockchain.
  version: '1.0'
  contact:
    name: Francisco M. Delicado
    email: francisco.delicado@uclm.es
  license:
    #¿Qué licencia es la más adecuada?
    name: GPLv3
    url: https://www.gnu.org/licenses/gpl-3.0.html

servers:
    #Especificar el servidor de pruebas ¿y el de producción?
  - description: Servidor de pruebas
    url: https://api.server.test/v1
  - description: Servidor de producción
    url: https://api.server.production/v1

tags:
  - name: altas
    description: Altas de empresas, productos y contenedores
  - name: compras y ventas
    description: Compras y ventas de productos
  - name: transiciones
    description: Transiciones de productos entre contenedores
  - name: trazabilidad
    description: Consulta de trazabilidad de productos

paths:
  /add/company:
    post:
      tags:
        - altas
      summary: Añadir una empresa
      description: Añade una empresa a la blockchain
      requestBody:
        description: Empresa a añadir
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Empresa_add'
      responses:
        '200':
          description: OK. Operación completada con éxito.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Empresa'

  /add/product:
    post:
      tags:
        - altas
      summary: Añadir un producto
      description: Añade un producto a la blockchain
      requestBody:
        description: Producto a añadir
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Producto_add'
      responses:
        '200':
          description: OK. Operación completada con éxito.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Producto'

  /add/container:
    post:
      tags:
        - altas
      summary: Añadir un contenedor
      description: Añade un contenedor a la blockchain
      requestBody:
        description: Contenedor a añadir
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Contenedor'
      responses:
        '200':
          description: OK. Operación completada con éxito.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Contenedor'

  /add/purchase:
    post:
      tags:
        - compras y ventas
      summary: Añadir una compra
      description: Añade una compra a la blockchain
      requestBody:
        description: Compra a añadir
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Compra'
      responses:
        '200':
          description: OK. Operación completada con éxito.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Compra'

  /add/sale:
    post:
      tags:
        - compras y ventas
      summary: Añadir una venta
      description: Añade una venta a la blockchain
      requestBody:
        description: Venta a añadir
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Venta'
      responses:
        '200':
          description: OK. Operación completada con éxito.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Venta'


  /add/transition:
    post:
      tags:
        - transiciones
      summary: Añadir una transición
      description: Añade una transición a la blockchain
      requestBody:
        description: Transición a añadir
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Transicion'
      responses:
        '200':
          description: OK. Operación completada con éxito.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Transicion'

  /traceability:
    get:
      tags:
        - trazabilidad
      summary: Consultar trazabilidad de un producto
      description: Consulta la trazabilidad de un producto
      parameters:
        - name: num_lote
          in: query
          description: ID del producto
          required: true
          schema:
            $ref: '#/components/schemas/Num_Lote'
      responses:
        '200':
          description: OK. Operación completada con éxito.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Accion'

components:
  schemas:

    Empresa_add:
      required:
        - id
        - nombre
        - cif
      type: object
      properties:
        id:
          $ref: '#/components/schemas/ID'
        nombre:
          type: string
          description: Nombre de la empresa
        cif: 
          type: string
          description: Código de identificación fiscal
        tipo_std:
            type: string
            description: Tipo de empresa
            enum:
              - Bodega
              - Distribuidor
              - Tienda
              - Restaurante
              - Particular
              - Viticultor
              - otros
        tipo_otros:
            type: string
            description: Tipo de empresa 
        info:
          content: application/json
          $ref: '#/components/schemas/InfoEmpresa_add'

    Empresa:
      required:
        - id
        - nombre
        - cif
      type: object
      properties:
        id:
          $ref: '#/components/schemas/ID'
        nombre:
          type: string
          description: Nombre de la empresa
        cif: 
          type: string
          description: Código de identificación fiscal
        tipo_std:
            type: string
            description: Tipo de empresa
            enum:
              - Bodega
              - Distribuidor
              - Tienda
              - Restaurante
              - Particular
              - Viticultor
              - otros
        tipo_otros:
            type: string
            description: Tipo de empresa 
        info:
          content: application/json
          $ref: '#/components/schemas/InfoEmpresa'
    
    InfoEmpresa_add:
      type: object
      properties:           
        direccion: 
          type: string
          description: Dirección de la empresa
          example: C/ Ejemplo, 1
        telefono: 
          type: string
          description: Teléfono de la empresa
          example: 687-59-59-59
        email:
          type: string
          description: Email de la empresa
          example: contacto@empresa1.com
        web:
          type: string
          description: Página web de la empresa
          example: www.empresa1.com
        # certificados:
        #   description: Certificados del vino subidos a IPFS
        #   type: array
        #   items:
        #     anyOf:
        #       - $ref: '#/components/schemas/cert_DOP_add'
        #       - $ref: '#/components/schemas/cert_IGP_add'
        #       - $ref: '#/components/schemas/cert_Otros_add'

    InfoEmpresa:
      type: object
      properties:           
        direccion: 
          type: string
          description: Dirección de la empresa
          example: C/ Ejemplo, 1
        telefono: 
          type: string
          description: Teléfono de la empresa
          example: 687-59-59-59
        email:
          type: string
          description: Email de la empresa
          example: contacto@empresa1.com
        web:
          type: string
          description: Página web de la empresa
          example: www.empresa1.com
        # certificados:
        #   description: Certificados del vino subidos a IPFS
        #   type: array
        #   items:
        #     anyOf:
        #       - $ref: '#/components/schemas/cert_DOP'
        #       - $ref: '#/components/schemas/cert_IGP'
        #       - $ref: '#/components/schemas/cert_Otros'

    Parcela_add:
      description: Información sobre la parcela de cultivo
      type: object
      required:
        - name
      properties:
        name:
          type: string
          description: Nombre de la parcela
          example: Finca Villa Hermoso
        localizacion:
          type: array
          description: Localización de la parcela
          items:
            anyOf:
              - $ref: '#/components/schemas/SigPac'
              - $ref: '#/components/schemas/Catastro'
        certificados:
          description: Certificados de la parcela subidos a IPFS
          type: array
          items:
            anyOf:
              - $ref: '#/components/schemas/cert_DOP_add'
              - $ref: '#/components/schemas/cert_IGP_add'
              - $ref: '#/components/schemas/cert_Otros_add'
              - $ref: '#/components/schemas/cert_Ecologico_add'

    Parcela:
      description: Información sobre la parcela de cultivo
      type: object
      required:
        - name
      properties:
        name:
          type: string
          description: Nombre de la parcela
          example: Finca Villa Hermoso
        localizacion:
          type: array
          description: Localización de la parcela
          items:
            anyOf:
              - $ref: '#/components/schemas/SigPac'
              - $ref: '#/components/schemas/Catastro'
        certificados:
          description: Certificados de la parcela subidos a IPFS
          type: array
          items:
            anyOf:
              - $ref: '#/components/schemas/cert_DOP'
              - $ref: '#/components/schemas/cert_IGP'
              - $ref: '#/components/schemas/cert_Otros'
              - $ref: '#/components/schemas/cert_Ecologico'
        
    Producto:
      required:
          - id
          - cantidad
      type: object
      properties:
        id:
          $ref: '#/components/schemas/ID'
        nombre:
          type: string
          description: Nombre del producto
        tipo:
          type: string
          description: Tipo de producto
          enum:
            - vino
            - uva
            - mosto
            - Otros
        cantidad:
          type: object
          description: Cantidad del producto. Se especifica cantidad y unidades
          properties:
            valor:
              type: number
              description: Cantidad del producto
            unidades:
              type: string
              description: Unidades de medida
              enum:
                - litros
                - kilos
        info:
          type: array
          description: Información sobre el producto, como está hecho, añadas, etc.
          items:
            oneOf:
            - $ref: '#/components/schemas/InfoVino'
            - $ref: '#/components/schemas/InfoUva'
            - $ref: '#/components/schemas/InfoMosto'
            - $ref: '#/components/schemas/InfoOtros'

    Producto_add:
      required:
          - id
          - cantidad
      type: object
      properties:
        id:
          $ref: '#/components/schemas/ID'
        nombre:
          type: string
          description: Nombre del producto
        tipo:
          type: string
          description: Tipo de producto
          enum:
            - vino
            - uva
            - mosto
            - Otros
          example: vino
        cantidad:
          type: object
          description: Cantidad del producto. Se especifica cantidad y unidades
          properties:
            valor:
              type: number
              description: Cantidad del producto
              example: 1500
            unidades:
              type: string
              description: Unidades de medida
              enum:
                - litros
                - kilos
        info:
          type: array
          description: Información sobre el producto, como está hecho, añadas, etc.
          items:
            oneOf:
            - $ref: '#/components/schemas/InfoVino_add'
            - $ref: '#/components/schemas/InfoUva_add'
            - $ref: '#/components/schemas/InfoMosto_add'
            - $ref: '#/components/schemas/InfoOtros_add'

        
    Producto_vendido:
      description: Producto que se ha vendido. Es un producto con un \#Lote que se utiliza para trazar el producto.
                   El resto de información es la misma que la de Producto.
      type: object
      properties:
        producto:
          $ref: '#/components/schemas/Producto'
        lote:
          $ref: '#/components/schemas/Lote'

    Compra:
      required:
        - id
        - fecha
        - vendedor
        - producto
        - a_contenedor
      type: object
      properties:
        id:
          $ref: '#/components/schemas/ID'
        fecha:
          type: string
          description: Fecha de la compra
          example: 2021-01-01
        vendedor:
          $ref: '#/components/schemas/Empresa'
        producto:
          $ref: '#/components/schemas/Producto'
        a_contenedor:
          $ref: '#/components/schemas/Contenedor'
        info:
          type: string
          description: Información adicional sobre la compra

    Venta:
      required:
        - id
        - fecha
        - comprador
        - producto
        - de_contenedor
      type: object
      properties:
        id:
          $ref: '#/components/schemas/ID'
        fecha:
          type: string
          description: Fecha de la venta
          example: 2021-01-01
        comprador:
          $ref: '#/components/schemas/Empresa'
        producto:
          $ref: '#/components/schemas/Producto_vendido'
        de_contenedor:
          $ref: '#/components/schemas/Contenedor'
        a_contenedor:
          $ref: '#/components/schemas/Contenedor'
        info:
          type: string
          description: Información adicional sobre la venta
    
    Transicion:
      required:
        - id
        - tipo
        - fecha
        - de_producto
        - a_producto
        - de_contenedor
        - a_contenedor
      type: object
      properties:
        id:
          $ref: '#/components/schemas/ID'
        tipo:
          type: string
          description: Tipo de transición
          enum:
            - prensado
            - trasiego
            - filtrado
            - fermentación
            - envasado
            - otros
        fecha:
          type: string
          description: Fecha de la transición
          example: 2021-01-01
        de_producto:
          $ref: '#/components/schemas/Producto'
        a_producto:
          $ref: '#/components/schemas/Producto'
        de_contenedor:
          $ref: '#/components/schemas/Contenedor'
        a_contenedor:
          $ref: '#/components/schemas/Contenedor'
        info:
          type: string
          description: Información adicional sobre la transición

    Accion:
      type: object
      properties:
        acciones:
          type: array
          items:
            oneOf:
              - $ref: '#/components/schemas/Compra'
              - $ref: '#/components/schemas/Transicion'
              - $ref: '#/components/schemas/Venta'

    ID:
      type:  string  
      description: Identificador único
      example: A12345678

    Num_Lote:
      type:  string  
      description: Número de lote
      example: 12345678
   
    Lote:
      description: Lote de producto
      required:
        - num_lote
        - caducidad
        - fecha_envasado
        - url
      type: object
      properties:
        num_lote:
          $ref: '#/components/schemas/Num_Lote'
        caducidad:
          type: string
          description: Fecha de caducidad
          example: 2021-12-31
        fecha_envasado:
          type: string
          description: Fecha de envasado
          example: 2021-01-01
        url:
          type: string
          description: URL de trazabilidad del lote. Con esta se podrá hacer la trazabilidad del lote en la blockchain.
          example: https://api.server.test/v1/lotes/12345678

    IPFSfile:
        description: Documento almacenado en IPFS
        type: object
        required:
          - ipfs_id  
        properties:
          ipfs_id: 
            type: string
            description: Hash del documento IPFS
            example: QmZ2YXJhY2NpZG9yZQ==
          name: 
            type: string
            description: Nombre del documento
            example: Certificado de D.O. Jumilla

    IPFSfile_add:
        description: Documento almacenado en IPFS
        type: object
        required:
          - file
        properties:
          file: 
              # Un fichero binario de cualquier tipo
              type: string
              format: binary
              example: DOJumilla_concesion.pdf
          name:
            type: string
            description: Nombre del documento
            example: Certificado de D.O. Jumilla

######################################
## Schemas para añadir productos
######################################

    InfoComponente:
      type: object
      description: Información sobre un componente de un producto. Se especifica el % de dicho componente y la uva que lo componen
      properties:
        porcentaje:
          type: number
          description: Porcentaje del componente en el producto
        uva:
          $ref: '#/components/schemas/InfoUva'
        
    InfoVino_add:
      type: object
      properties:
        color:
          type: string
          description: Tipo de vino según color de vino
          enum:
            - tinto
            - blanco
            - rosado
            - clarete
            - espumoso
        quimica:
          type: object
          description: Información química del vino
          properties:
            ga:
              type: number
              description: Graduación alcohólica %vol
              example: 12.5
            densidad:
              type: number
              description: Densidad del vino g/ml
              example: 0.99
            otros:
              type: string
              description: Otros datos químicos del vino
              example: 5.5 g/l de acidez total
        elaboracion:
          type: string
          description: Subtipo de vino según crianza
          enum:
            - joven
            - crianza
            - reserva
            - gran reserva
        composicion:
          type: array
          description: Variedades de uva que componen el vino y sus añadas
          items:
            $ref: '#/components/schemas/InfoComponente'
        certificados:
          description: Certificados del vino subidos a IPFS
          type: array
          items:
            anyOf:
              - $ref: '#/components/schemas/cert_DOP_add'
              - $ref: '#/components/schemas/cert_IGP_add'
              - $ref: '#/components/schemas/cert_Otros_add'
              - $ref: '#/components/schemas/cert_Ecologico_add'
              - $ref: '#/components/schemas/cert_Vegano_add'
              - $ref: '#/components/schemas/cert_Vegetariano_add'
              - $ref: '#/components/schemas/cert_Sulfitos_add'

    InfoUva_add:
      type : object
      properties:
        variedad:
          type: string
          description: Variedad de uva
          enum:
            - Cabernet Sauvignon
            - Cabernet Franc
            - Tempranillo
            - Garnacha
            - Carmenere
            - Pinot Noir
            - Merlot
            - Tannat
            - Bonarda
            - Syrah
            - Petit Verdot
            - Sangiovese
            - Malbec
            - Nebbiolo
            - Barbera
            - Montepulciano
            - Corvina
            - Rondinella
            - Molinara
            - Zinfandel
            - Airén
            - Macabeo
            - Parellada
            - Xarel·lo
            - Chardonnay
            - Sauvignon Blanc
            - Verdejo
            - Albariño
            - Godello
            - Viura
            - Moscatel
            - Gewürztraminer
            - Riesling
            - Chenin Blanc
            - Pinot Gris
            - Pinot Blanc
            - Viognier
            - Pedro Ximénez
            - Palomino
            - Malvasía
        añada:
          type: number
          description: Añada de la uva
          example: 2020
        color:
          type: string
          description: Tipo de vino según color de vino
          enum:
            - tinto
            - blanco
        conduccion:
          type: string
          description: Tipo de conducción de la uva
          enum:
            - espaldera
            - vaso
            - parral
        vendimia:
          type: string
          description: Tipo de vendimia de la uva
          enum:
            - manual
            - mecanica
        certificados:
          description: Certificados de la uva
          type: array
          items:
            anyOf:
              - $ref: '#/components/schemas/cert_DOP_add'
              - $ref: '#/components/schemas/cert_IGP_add'
              - $ref: '#/components/schemas/cert_Otros_add'
              - $ref: '#/components/schemas/cert_Ecologico_add'

    InfoMosto_add:
      type: object
      properties:
        tipo:
          type: string
          description: Tipo de mosto según proceso de elaboración
          enum:
            - simple
            - concentrado
            - sulfatado
            - primera presión
            - segunda presión
            - prensa
        color:
          type: string
          description: Tipo de vino según color de vino
          enum:
            - tinto
            - blanco
            - rosado
        quimica:
          type: object
          description: Información química del mosto
          properties:
            gap:
              type: number
              description: Graduación alcohólica potencial %vol
              example: 12.5
            densidad:
              type: number
              description: Densidad del vino g/ml
              example: 0.99
            otros:
              type: string
              description: Otros datos químicos del vino
              example: 5.5 g/l de acidez total
        composicion:
          type: array
          description: Uvas que componen el mosto
          items:
            $ref: '#/components/schemas/InfoComponente'
        certificados:
          description: Certificados del mosto
          type: array
          items:
            anyOf:
              - $ref: '#/components/schemas/cert_DOP_add'
              - $ref: '#/components/schemas/cert_IGP_add'
              - $ref: '#/components/schemas/cert_Otros_add'
              - $ref: '#/components/schemas/cert_Ecologico_add'
              - $ref: '#/components/schemas/cert_Vegano_add'
              - $ref: '#/components/schemas/cert_Vegetariano_add'

    InfoOtros_add:

      #¿Qué otros productos se pueden dar?
      type: object
      properties:
        descripcion:
          type: string
          description: Descripción del producto
          example: Tipo de producto "Otros" p.e. orujos
        composicion:
          type: array
          description: Variedades de uva que componen el producto
          items:
            $ref: '#/components/schemas/InfoComponente'

######################################
## Schemas para mostrar productos
######################################
    InfoVino:
      type: object
      properties:
        color:
          type: string
          description: Tipo de vino según color de vino
          enum:
            - tinto
            - blanco
            - rosado
            - clarete
            - espumoso
        quimica:
          type: object
          description: Información química del vino
          properties:
            ga:
              type: number
              description: Graduación alcohólica %vol
              example: 12.5
            densidad:
              type: number
              description: Densidad del vino g/ml
              example: 0.99
            otros:
              type: string
              description: Otros datos químicos del vino
              example: 5.5 g/l de acidez total
        elaboracion:
          type: string
          description: Subtipo de vino según crianza
          enum:
            - joven
            - crianza
            - reserva
            - gran reserva
        composicion:
          type: array
          description: Variedades de uva que componen el vino y sus añadas
          items:
            $ref: '#/components/schemas/InfoComponente'
        certificados:
          description: Certificados del vino subidos a IPFS
          type: array
          items:
            anyOf:
              - $ref: '#/components/schemas/cert_DOP'
              - $ref: '#/components/schemas/cert_IGP'
              - $ref: '#/components/schemas/cert_Otros'
              - $ref: '#/components/schemas/cert_Ecologico'
              - $ref: '#/components/schemas/cert_Vegano'
              - $ref: '#/components/schemas/cert_Vegetariano'
              - $ref: '#/components/schemas/cert_Sulfitos'

    InfoUva:
      type : object
      properties:
        variedad:
          type: string
          description: Variedad de uva
          enum:
            - Cabernet Sauvignon
            - Cabernet Franc
            - Tempranillo
            - Garnacha
            - Carmenere
            - Pinot Noir
            - Merlot
            - Tannat
            - Bonarda
            - Syrah
            - Petit Verdot
            - Sangiovese
            - Malbec
            - Nebbiolo
            - Barbera
            - Montepulciano
            - Corvina
            - Rondinella
            - Molinara
            - Zinfandel
            - Airén
            - Macabeo
            - Parellada
            - Xarel·lo
            - Chardonnay
            - Sauvignon Blanc
            - Verdejo
            - Albariño
            - Godello
            - Viura
            - Moscatel
            - Gewürztraminer
            - Riesling
            - Chenin Blanc
            - Pinot Gris
            - Pinot Blanc
            - Viognier
            - Pedro Ximénez
            - Palomino
            - Malvasía
        añada:
          type: number
          description: Añada de la uva
          example: 2020
        color:
          type: string
          description: Tipo de vino según color de vino
          enum:
            - tinto
            - blanco
        conduccion:
          type: string
          description: Tipo de conducción de la uva
          enum:
            - espaldera
            - vaso
            - parral
        vendimia:
          type: string
          description: Tipo de vendimia de la uva
          enum:
            - manual
            - mecanica
        certificados:
          description: Certificados de la uva
          type: array
          items:
            anyOf:
              - $ref: '#/components/schemas/cert_DOP'
              - $ref: '#/components/schemas/cert_IGP'
              - $ref: '#/components/schemas/cert_Otros'
              - $ref: '#/components/schemas/cert_Ecologico'

    InfoMosto:
      type: object
      properties:
        tipo:
          type: string
          description: Tipo de mosto según proceso de elaboración
          enum:
            - simple
            - concentrado
            - sulfatado
            - primera presión
            - segunda presión
            - prensa
        color:
          type: string
          description: Tipo de vino según color de vino
          enum:
            - tinto
            - blanco
            - rosado
        quimica:
          type: object
          description: Información química del mosto
          properties:
            gap:
              type: number
              description: Graduación alcohólica potencial %vol
              example: 12.5
            densidad:
              type: number
              description: Densidad del vino g/ml
              example: 0.99
            otros:
              type: string
              description: Otros datos químicos del vino
              example: 5.5 g/l de acidez total
        composicion:
          type: array
          description: Uvas que componen el mosto
          items:
            $ref: '#/components/schemas/InfoComponente'
        certificados:
          description: Certificados del mosto
          type: array
          items:
            anyOf:
              - $ref: '#/components/schemas/cert_DOP'
              - $ref: '#/components/schemas/cert_IGP'
              - $ref: '#/components/schemas/cert_Otros'
              - $ref: '#/components/schemas/cert_Ecologico'
              - $ref: '#/components/schemas/cert_Vegano'
              - $ref: '#/components/schemas/cert_Vegetariano'

    InfoOtros:

      #¿Qué otros productos se pueden dar?
      type: object
      properties:
        descripcion:
          type: string
          description: Descripción del producto
        composicion:
          type: array
          description: Variedades de uva que componen el producto
          items:
            $ref: '#/components/schemas/InfoComponente'

#######################################
## Schemas para contenedores
#######################################

    Contenedor:
      required:
        - id
      description: Cualquier tipo de contenedor de productos
      type: object
      properties:
        id:
          $ref: '#/components/schemas/ID'
        info:
          oneOf:
            - $ref: '#/components/schemas/InfoDescargadero'
            - $ref: '#/components/schemas/InfoDeposito'
            - $ref: '#/components/schemas/InfoBarrica'
            - $ref: '#/components/schemas/InfoBotella'
            - $ref: '#/components/schemas/InfoBaginBox'
            - $ref: '#/components/schemas/InfoGarrafa'
            - $ref: '#/components/schemas/InfoLata'
            - $ref: '#/components/schemas/InfoTetraPack'
            - $ref: '#/components/schemas/InfoCisterna'

    InfoDescargadero:
      description: Información sobre el descargadero
      type: object
      properties:
        tipo: 
          type: string
          enum:
            - descargadero
        dimensiones:
          type: object
          description: Dimensiones del descargadero
          properties:
            alto:
              type: number
              description: Alto del descargadero en cm
            ancho:
              type: number
              description: Ancho del descargadero en cm
            largo:
              type: number
              description: Largo del descargadero en cm
            capacidad:
              type: number
              description: Capacidad del descargadero en litros
        material:
          type: string
          description: Material del que está hecho el descargadero
          enum:
            - acero inoxidable
            - hormigón
            - plástico
            - madera
            - otros
    
    InfoDeposito:
      description: Información sobre el depósito
      type: object
      properties:
        tipo: 
          type: string
          enum:
            - depósito
        dimensiones:
          type: object
          description: Dimensiones del depósito
          properties:
            alto:
              type: number
              description: Alto del depósito en cm
            ancho:
              type: number
              description: Ancho del depósito en cm
            largo:
              type: number
              description: Largo del depósito en cm
            capacidad:
              type: number
              description: Capacidad del depósito en litros
        material:
          type: string
          description: Material del que está hecho el depósito
          enum:
            - acero inoxidable
            - hormigón
            - plástico
            - madera
            - otros

    InfoBarrica:
      description: Información sobre la barrica
      type: object
      properties:
        tipo: 
          type: string
          enum:
            - barrica
        dimensiones:
          type: object
          description: Dimensiones de la barrica
          properties:
            alto:
              type: number
              description: Alto de la barrica en cm
            ancho:
              type: number
              description: Ancho de la barrica en cm
            largo:
              type: number
              description: Largo de la barrica en cm
            capacidad:
              type: number
              description: Capacidad de la barrica en litros
        material:
          type: string
          description: Material del que está hecha la barrica
          enum:
            - roble
            - acacia
            - castaño
            - otros
        tostado:
          type: string
          description: Tostado de la barrica
          enum:
            - ligero
            - medio
            - fuerte
        edad:
          type: number
          description: Edad de la barrica en años

    InfoBotella:
      description: Información sobre la botella
      type: object
      properties:
        tipo_std: 
          type: string
          description: Tipo de botella
          enum:
            - borgoña
            - bordelesa cónica
            - bordelesa no cónica
            - otros
        tipo_otros:
          type: string
          description: Tipo de botella
        dimensiones:
          type: object
          description: Dimensiones de la botella
          properties:
            alto:
              type: number
              description: Alto de la botella en cm
            ancho:
              type: number
              description: Ancho de la botella en cm
            largo:
              type: number
              description: Largo de la botella en cm
            capacidad:
              type: number
              description: Capacidad de la botella en litros
        material:
          type: string
          description: Material del que está hecha la botella
          enum:
            - vidrio
            - plástico
            - otros
        color:
          type: string
          description: Color de la botella
          enum:
            - verde
            - marrón
            - transparente
        tapón:
          type: string
          description: Tipo de tapón de la botella
          enum:
            - corcho
            - rosca
            - otros

    InfoBaginBox:
      description: Información sobre el bag in box
      type: object
      properties:
        tipo: 
          type: string
          enum:
            - bag in box
        dimensiones:
          type: object
          description: Dimensiones del bag in box
          properties:
            alto:
              type: number
              description: Alto del bag in box en cm
            ancho:
              type: number
              description: Ancho del bag in box en cm
            largo:
              type: number
              description: Largo del bag in box en cm
            capacidad:
              type: number
              description: Capacidad del bag in box en litros
        material:
          type: string
          description: Material del que está hecho el bag in box
          enum:
            - plástico
            - cartón
            - otros

    InfoGarrafa:
      description: Información sobre la garrafa
      type: object
      properties:
        tipo: 
          type: string
          enum:
            - garrafa
        dimensiones:
          type: object
          description: Dimensiones de la garrafa
          properties:
            alto:
              type: number
              description: Alto de la garrafa en cm
            ancho:
              type: number
              description: Ancho de la garrafa en cm
            largo:
              type: number
              description: Largo de la garrafa en cm
            capacidad:
              type: number
              description: Capacidad de la garrafa en litros
        material:
          type: string
          description: Material del que está hecha la garrafa
          enum:
            - plástico
            - vidrio
            - otros

    InfoLata:
      description: Información sobre la lata
      type: object
      properties:
        tipo: 
          type: string
          enum:
            - lata
        dimensiones:
          type: object
          description: Dimensiones de la lata
          properties:
            alto:
              type: number
              description: Alto de la lata en cm
            ancho:
              type: number
              description: Ancho de la lata en cm
            largo:
              type: number
              description: Largo de la lata en cm
            capacidad:
              type: number
              description: Capacidad de la lata en litros
        material:
          type: string
          description: Material del que está hecha la lata
          enum:
            - aluminio
            - otros

    InfoTetraPack:
      description: Información sobre el tetra pack
      type: object
      properties:
        tipo: 
          type: string
          enum:
            - tetra pack
        dimensiones:
          type: object
          description: Dimensiones del tetra pack
          properties:
            alto:
              type: number
              description: Alto del tetra pack en cm
            ancho:
              type: number
              description: Ancho del tetra pack en cm
            largo:
              type: number
              description: Largo del tetra pack en cm
            capacidad:
              type: number
              description: Capacidad del tetra pack en litros
        material:
          type: string
          description: Material del que está hecho el tetra pack
          enum:
            - cartón
            - otros

    InfoCisterna:
      description: Información sobre la cisterna
      type: object
      properties:
        tipo: 
          type: string
          enum:
            - cisterna
        dimensiones:
          type: object
          description: Dimensiones de la cisterna
          properties:
            alto:
              type: number
              description: Alto de la cisterna en cm
            ancho:
              type: number
              description: Ancho de la cisterna en cm
            largo:
              type: number
              description: Largo de la cisterna en cm
            capacidad:
              type: number
              description: Capacidad de la cisterna en litros
        material:
          type: string
          description: Material del que está hecha la cisterna
          enum:
            - acero inoxidable
            - plástico
            - otros

    SigPac:
      description: Información SIGPAC sobre la parcela de cultivo
      required:
        - provincia
        - municipio
        - poligono
        - parcela
        - recinto
      type: object
      properties:
        provincia:
          type: number
          description: Provincia de la parcela
          example: 2 es Albacete
        municipio:
          type: number
          description: Municipio de la parcela
          example: 900 es Albacete
        poligono:
          type: number
          description: Numeración que se le da al polígono
          example: 29
        parcela:
          type: number
          description: Numeración que se le da a la parcela
          example: 2
        recinto: 
          type: number
          description: Numeración que se le da al recinto
          example: 1

    Catastro:
      description: Información catastral sobre la parcela de cultivo
      required:
        - ref_catastral
      type: object
      properties:
        ref_catastral:
          type: string
          description: Referencia catastral de la parcela
          example: 02900A077000730000JB


########################################################
## Schemas para añadir de certificados
########################################################    

    cert_DOP_add:
      description: Certificado de Denominación de Origen Protegida
      type: object
      properties:
        type:
          type: string
          description: Tipo de certificado
          enum:
            - DOP
        name:
          type: string
          description: Nombre de la DOP
          example: D.O. Jumilla
        certificado:
          $ref: '#/components/schemas/cert_template_add'
    
    cert_IGP_add:
      description: Certificado de Indicación Geográfica Protegida
      type: object
      properties:
        type:
          type: string
          description: Tipo de certificado
          enum:
            - IGP
        name:
          type: string
          description: Nombre de la IGP
          example: IGP Vinos de la Tierra de Castilla
        certificado:
          $ref: '#/components/schemas/cert_template_add'

    

    cert_Ecologico_add:
      description: Certificado de producto ecológico
      type: object
      properties:
        tipo:
          type: string
          description: Tipo de certificado
          enum:
            - ecológico
        name:
          type: string
          description: Nombre del certificado
          example: Certificado de producto ecológico
        certificadora:
          $ref: '#/components/schemas/cert_template_add'
        extra:
          type: array
          items:
            anyOf:
              - $ref: '#/components/schemas/Sist_Produccion_Biodinamico_add'
              - $ref: '#/components/schemas/Sist_Produccion_Natural_add'

    
    Sist_Produccion_Biodinamico_add:
      description: Sistema de producción ecológica biodinámico
      type: object
      properties:
        tipo:
          type: string
          description: Tipo de certificado
          enum:
            - biodinámico
        certificado:
          $ref: '#/components/schemas/cert_template_add'

    Sist_Produccion_Natural_add:
      description: Sistema de producción ecológica natural
      type: object
      properties:
        tipo:
          type: string
          description: Tipo de certificado
          enum:
            - natural
        certificado:
          $ref: '#/components/schemas/cert_template_add'

    cert_Vegano_add:
      description: Certificado de producto vegano
      type: object
      properties:
        tipo:
          type: string
          description: Tipo de certificado
          enum:
            - vegano
        name:
          type: string
          description: Nombre del certificado
          example: Certificado de producto vegano
        certificado:
          $ref: "#/components/schemas/cert_template_add"

    cert_Vegetariano_add:
      description: Certificado de producto vegetariano
      type: object
      properties:
        tipo:
          type: string
          description: Tipo de certificado
          enum:
            - vegetariano
        name:
          type: string
          description: Nombre del certificado
          example: Certificado de producto vegetariano
        certificado:
          $ref: "#/components/schemas/cert_template_add"

    cert_Sulfitos_add:
      # description: Certificado de producto sin sulfitos añadidos
      # type: object
      # properties:
      #   name:
      #     type: string
      #     description: Nombre del certificado
      #     example: Certificado de producto sin sulfitos añadidos
      #   sultfitos:
          # type: array
          # description: Tipo de certificado
          # items:
      oneOf:
        - $ref: '#/components/schemas/Con_Sulfitos_add'
        - $ref: '#/components/schemas/Sin_Sulfitos_add'

    Con_Sulfitos_add:
      description: Certificado de producto con sulfitos añadidos
      type: object
      properties:
        tipo:
          type: string
          description: Tipo de certificado
          enum:
            - con sulfitos añadidos
        valor:
          type: number
          description: Valor máximo de sulfitos añadidos en mg/l
          example: 25
        certificado:
          $ref: "#/components/schemas/cert_template_add"

    Sin_Sulfitos_add:
      description: Certificado de producto sin sulfitos añadidos
      type: object
      properties:
        tipo:
          type: string
          description: Tipo de certificado
          enum:
            - sin sulfitos añadidos
        certificado:
          $ref: '#/components/schemas/cert_template_add'

    cert_Otros_add:
      type: object
      properties:
        type:
          type: string
          description: Otros tipos de certificados
          enum:
            - otros
        name:
          type: string
          description: Nombre del certificado
          example: Otro tipo de certificación
        certificado:
          $ref: '#/components/schemas/cert_template_add'

    cert_template_add:
      description: Certificado de producto
      type: object
      properties:
        name:
          type: string
          description: Nombre del certificado
          example: Certificado de producto
        files:
          description: Certificado subido a IPFS
          type: array
          items:
            $ref: '#/components/schemas/IPFSfile_add'
        certificadora:
          type: string
          description: Nombre de la certificadora
          example: CCPAE
        fecha_certificacion:
          type: string
          description: Fecha de certificación
          example: 2021-01-01
        fecha_expiracion:
          type: string
          description: Fecha de expiración del certificado
          example: 2022-01-01
        info:
          type: string
          description: Información adicional sobre el certificado



########################################################
## Schemas para visualización de certificados
########################################################
    cert_DOP:
      description: Certificado de Denominación de Origen Protegida
      type: object
      properties:
        type:
          type: string
          description: Tipo de certificado
          enum:
            - DOP
        name:
          type: string
          description: Nombre de la DOP
          example: D.O. Jumilla
        certificado:
          $ref: '#/components/schemas/cert_template'
    
    cert_IGP:
      description: Certificado de Indicación Geográfica Protegida
      type: object
      properties:
        type:
          type: string
          description: Tipo de certificado
          enum:
            - IGP
        name:
          type: string
          description: Nombre de la IGP
          example: IGP Vinos de la Tierra de Castilla
        certificado:
          $ref: '#/components/schemas/cert_template'

    

    cert_Ecologico:
      description: Certificado de producto ecológico
      type: object
      properties:
        tipo:
          type: string
          description: Tipo de certificado
          enum:
            - ecológico
        name:
          type: string
          description: Nombre del certificado
          example: Certificado de producto ecológico
        certificadora:
          $ref: '#/components/schemas/cert_template'
        extra:
          type: array
          items:
            anyOf:
              - $ref: '#/components/schemas/Sist_Produccion_Biodinamico'
              - $ref: '#/components/schemas/Sist_Produccion_Natural'

    
    Sist_Produccion_Biodinamico:
      description: Sistema de producción ecológica biodinámico
      type: object
      properties:
        tipo:
          type: string
          description: Tipo de certificado
          enum:
            - biodinámico
        certificado:
          $ref: '#/components/schemas/cert_template'

    Sist_Produccion_Natural:
      description: Sistema de producción ecológica natural
      type: object
      properties:
        tipo:
          type: string
          description: Tipo de certificado
          enum:
            - natural
        certificado:
          $ref: '#/components/schemas/cert_template'

    cert_Vegano:
      description: Certificado de producto vegano
      type: object
      properties:
        tipo:
          type: string
          description: Tipo de certificado
          enum:
            - vegano
        name:
          type: string
          description: Nombre del certificado
          example: Certificado de producto vegano
        certificado:
          $ref: "#/components/schemas/cert_template"

    cert_Vegetariano:
      description: Certificado de producto vegetariano
      type: object
      properties:
        tipo:
          type: string
          description: Tipo de certificado
          enum:
            - vegetariano
        name:
          type: string
          description: Nombre del certificado
          example: Certificado de producto vegetariano
        certificado:
          $ref: "#/components/schemas/cert_template"

    cert_Sulfitos:
      # description: Certificado de producto sin sulfitos añadidos
      # type: object
      # properties:
      #   name:
      #     type: string
      #     description: Nombre del certificado
      #     example: Certificado de producto sin sulfitos añadidos
      #   sultfitos:
          # type: array
          # description: Tipo de certificado
          # items:
      oneOf:
        - $ref: '#/components/schemas/Con_Sulfitos'
        - $ref: '#/components/schemas/Sin_Sulfitos'

    Con_Sulfitos:
      description: Certificado de producto con sulfitos añadidos
      type: object
      properties:
        tipo:
          type: string
          description: Tipo de certificado
          enum:
            - con sulfitos añadidos
        valor:
          type: number
          description: Valor máximo de sulfitos añadidos en mg/l
          example: 25
        certificado:
          $ref: "#/components/schemas/cert_template"

    Sin_Sulfitos:
      description: Certificado de producto sin sulfitos añadidos
      type: object
      properties:
        tipo:
          type: string
          description: Tipo de certificado
          enum:
            - sin sulfitos añadidos
        certificado:
          $ref: '#/components/schemas/cert_template'

    cert_Otros:
      type: object
      properties:
        type:
          type: string
          description: Otros tipos de certificados
          enum:
            - otros
        name:
          type: string
          description: Nombre del certificado
          example: Otro tipo de certificación
        certificado:
          $ref: '#/components/schemas/cert_template'

    cert_template:
      description: Certificado de producto
      type: object
      properties:
        name:
          type: string
          description: Nombre del certificado
          example: Certificado de producto
        files:
          description: Certificado subido a IPFS
          type: array
          items:
            $ref: '#/components/schemas/IPFSfile'
        certificadora:
          type: string
          description: Nombre de la certificadora
          example: CCPAE
        fecha_certificacion:
          type: string
          description: Fecha de certificación
          example: 2021-01-01
        fecha_expiracion:
          type: string
          description: Fecha de expiración del certificado
          example: 2022-01-01
        info:
          type: string
          description: Información adicional sobre el certificado
